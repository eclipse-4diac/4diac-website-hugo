{{/* 
  Copyright (c) 2023, 2024 Eclipse Foundation, Inc.
  This program and the accompanying materials are made available under the
  terms of the Eclipse Public License v. 2.0 which is available at
  http://www.eclipse.org/legal/epl-2.0.

  Contributors:
    Olivier Goulet &lt;olivier.goulet@eclipse-foundation.org&gt;
    Zachary Sabourin &lt;zachary.sabourin@eclipse-foundation.org&gt;

  SPDX-License-Identifier: EPL-2.0
*/}}

{{ if isset .Site.Menus "sidebar" }}
  {{ $currentPage := . }}
  {{ $identifiers := slice "home" }}

  {{ if .Page.Params.sidebar }}
    {{ $identifiers = .Page.Params.sidebar }}
  {{ else if .Page.Section }}
    {{ $identifiers = slice .Page.Section }}
  {{ end }}
  
  {{ $menu_sections := where .Site.Menus.sidebar "Identifier" "in" $identifiers}}

  {{ with $menu_sections }}
    <aside class="main-sidebar-default-margin" id="main-sidebar">
      {{ range . }}
        {{ if .HasChildren }}
          <ul class="ul-left-nav" id="leftnav" role="tablist" aria-multiselectable="true">
            <li class="main-sidebar-main-item main-sidebar-item-indented separator">
              {{ if .URL }}
                <a class="main-sidebar-heading link-unstyled" href="{{ .URL }}">
                  {{ .Name }}
                </a>
              {{ else }}
                <p class="main-sidebar-heading">
                  {{ .Name }}
                </p>
              {{ end }}
            </li>
            {{ range .Children }}
              {{ $active := or (eq $currentPage.RelPermalink (.URL | relURL)) (eq $currentPage.Permalink (.URL | absURL)) }}
              {{ $hasActiveChild := false }}
              {{ range .Children }}
                {{ if or (eq $currentPage.RelPermalink (.URL | relURL)) (eq $currentPage.Permalink (.URL | absURL)) }}
                  {{ $hasActiveChild = true }}
                {{ end }}
              {{ end }}
              <li class="main-sidebar-item main-sidebar-item-indented">
                {{ if .HasChildren }}
                  <li class="main-sidebar-item main-sidebar-item-indented">
                    <a class="link-unstyled{{ if or $active $hasActiveChild }} main-sidebar-item-active{{ end }}" role="button" data-toggle="collapse" href="#{{ .Identifier }}" aria-expanded="{{ if or $active $hasActiveChild }}true{{ else }}false{{ end }}" aria-controls="{{ .Identifier }}">
                      <span>{{ .Name }}</span>
                      <i class="main-sidebar-item-icon fa fa-chevron-down" aria-hidden="true"></i>
                    </a>
                    <div class="collapse{{ if or $active $hasActiveChild }} in{{ end }}" id="{{ .Identifier }}">
                      <ul class="main-sidebar-item-submenu list-unstyled">
                        {{ range .Children }}
                        {{ $activeChild := or (eq $currentPage.RelPermalink (.URL | relURL)) (eq $currentPage.Permalink (.URL | absURL)) }}
                        <li class="submenu-item">
                          {{ .Pre }}
                          <a class="link-unstyled{{ if $activeChild }} main-sidebar-item-active{{ end }}" href="{{ .URL | relURL }}" target="_self">{{ .Name }}</a>
                        </li>
                        {{ end }}
                      </ul>
                    </div>
                  </li>
                {{ else }}
                  {{ $activeItem := or (eq $currentPage.RelPermalink (.URL | relURL)) (eq $currentPage.Permalink (.URL | absURL)) }}
                  <li class="main-sidebar-item main-sidebar-item-indented">
                    <a class="link-unstyled{{ if $activeItem }} main-sidebar-item-active{{ end }}" href="{{ .URL | relURL }}">
                      <div>
                        <span class="main-sidebar-item-pre" aria-hidden="true">
                          {{ .Pre }}
                        </span>
                        {{ .Name }}
                      </div>
                    </a>
                  </li>
                {{ end }}
              </li>
            {{ end }}
          </ul>
        {{ end }}
      {{ end }}
    </aside>
  {{ end }}
{{ end }}
